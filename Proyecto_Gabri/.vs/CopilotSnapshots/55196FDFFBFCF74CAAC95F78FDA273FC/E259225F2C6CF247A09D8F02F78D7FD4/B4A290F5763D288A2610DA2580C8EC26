using System;
using System.Windows;
using System.Windows.Input;

namespace Proyecto_Gabri
{
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();
        }

        private void BtnIniciarSesion_Click(object sender, RoutedEventArgs e)
        {
            var usuario = txtUsuario.Text?.Trim();
            var clave = pwdContrasena.Password;

            if (string.IsNullOrEmpty(usuario))
            {
                MessageBox.Show("Introduce el usuario.", "Error", MessageBoxButton.OK, MessageBoxImage.Warning);
                txtUsuario.Focus();
                return;
            }

            if (string.IsNullOrEmpty(clave))
            {
                MessageBox.Show("Introduce la contraseña.", "Error", MessageBoxButton.OK, MessageBoxImage.Warning);
                pwdContrasena.Focus();
                return;
            }

            if (usuario == "admin" && clave == "1234")
            {
                MessageBox.Show("Autenticación correcta. Bienvenido.", "OK", MessageBoxButton.OK, MessageBoxImage.Information);
                // Pass authenticated flag so PrincipalWindow updates the button to "Mi Perfil"
                var principal = new PrincipalWindow(true);
                principal.Show();
                Application.Current.MainWindow = principal;
                this.Close(); // opcional: cerrar la MainWindow
            }
            else
            {
                MessageBox.Show("Usuario o contraseña incorrectos.", "Error", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        // Abre RegisterWindow y cierra la MainWindow
        private void BtnRegistrarse_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                var registerWindow = new RegisterWindow()
                {
                    WindowStartupLocation = WindowStartupLocation.CenterScreen
                };

                registerWindow.Show();
                Application.Current.MainWindow = registerWindow;
                this.Close();
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Error al abrir ventana de registro:\n{ex.Message}", "ERROR", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        // Maneja el click en "¿Olvidaste tu contraseña?" — abre ForgotPasswordWindow y cierra esta ventana
        private void TxtOlvidaste_MouseLeftButtonUp(object sender, MouseButtonEventArgs e)
        {
            try
            {
                var forgotWindow = new ForgotPasswordWindow()
                {
                    WindowStartupLocation = WindowStartupLocation.CenterScreen
                };

                forgotWindow.Show();
                Application.Current.MainWindow = forgotWindow;
                this.Close();
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Error al abrir ventana de recuperación:\n{ex.Message}", "ERROR", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        // Abre BookingWindow y cierra la MainWindow
        private void BtnReservarHotel_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                var bookingWindow = new BookingWindow()
                {
                    WindowStartupLocation = WindowStartupLocation.CenterScreen
                };

                bookingWindow.Show();
                Application.Current.MainWindow = bookingWindow;
                this.Close();
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Error al abrir ventana de reservas:\n{ex.Message}", "ERROR", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }
    }
}